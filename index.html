<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Rohstoff-Karte mit Wichtigkeit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100vh;
      width: 100vw;
    }
    .legend, .priority {
      position: absolute;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      font-family: sans-serif;
      font-size: 14px;
      display: flex;
      gap: 10px;
      cursor: pointer;
      user-select: none;
      z-index: 1000;
      flex-wrap: wrap;
    }
    .legend {
      bottom: 20px;
      right: 20px;
      max-width: 400px;
    }
    .priority {
      bottom: 20px;
      left: 20px;
    }
    .icon, .prio {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 6px;
      border: 2px solid transparent;
      border-radius: 6px;
      transition: border-color 0.3s;
      min-width: 48px;
    }
    .icon.active, .prio.active {
      border-color: #0078ff;
      background-color: #e0f0ff;
    }
    .icon img, .prio div {
      width: 32px;
      height: 32px;
      pointer-events: none;
      border-radius: 50%;
    }
    .prio div {
      border: 2px solid #333;
    }
    .prio span {
      font-size: 12px;
    }
    .marker-wrapper {
      position: relative;
      width: 32px;
      height: 32px;
    }
    .marker-wrapper img {
      width: 100%;
      height: 100%;
    }
    .marker-priority {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 0 2px #000;
    }
  </style>
</head>
<body>

<div id="map"></div>

<div class="legend" id="legend"></div>
<div class="priority" id="priority"></div>

<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  crossorigin=""
></script>

<script>
  const map = L.map('map').setView([30, 10], 3);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap-Mitwirkende'
  }).addTo(map);

  const resources = [
    { id: 'eisen', name: 'Eisen' },
    { id: 'kupfer', name: 'Kupfer' },
    { id: 'lithium', name: 'Lithium' },
    { id: 'salz', name: 'Salz' },
    { id: 'erdgas', name: 'Erdgas' },
    { id: 'wasser', name: 'Wasser' },
    { id: 'holz', name: 'Holz' },
    { id: 'diamant', name: 'Diamant' },
    { id: 'kohle', name: 'Kohle' },
    { id: 'uran', name: 'Uran' }
  ];

  const iconUrls = [
    'https://i.postimg.cc/MKtSBSKG/TOOLS-069-removebg-preview.png',
    'https://i.postimg.cc/NG6YgX3m/Shid-removebg-preview.png',
    'https://i.postimg.cc/7LjDLnPM/Science-flask-symbol-removebg-preview.png',
    'https://i.postimg.cc/Twmx55p8/Religious-Salt-free-icons-designed-by-Freepik-removebg-preview.png',
    'https://i.postimg.cc/FHRQgB7V/images-removebg-preview.png',
    'https://i.postimg.cc/T37fzXZs/H2o-Clipart-Transparent-Background-Vector-H2o-Icon-H20-Water-Drop-PNG-Image-For-Free-Download-re.png',
    'https://i.postimg.cc/kXynySwq/Download-16-removebg-preview.png',
    'https://i.postimg.cc/3J3hWRh6/Download-15-removebg-preview.png',
    'https://i.postimg.cc/pL6M0Jjb/Download-14-removebg-preview.png',
    'https://i.postimg.cc/g0xmdTp2/Alchemy-Symbols-Visual-Library-of-Alchemy-Symbols-removebg-preview.png'
  ];

  const priorities = [
    { id: 'low', name: 'Niedrig', color: 'green' },
    { id: 'medium', name: 'Mittel', color: 'orange' },
    { id: 'high', name: 'Hoch', color: 'red' }
  ];

  const resourcesWithIcons = resources.map((res, idx) => ({
    ...res,
    iconUrl: iconUrls[idx]
  }));

  let activeResource = null;
  let activePriority = null;

  const markersLayer = L.layerGroup().addTo(map);
  const legendDiv = document.getElementById('legend');
  const priorityDiv = document.getElementById('priority');

  function updateLegendUI() {
    document.querySelectorAll('.icon').forEach(el => {
      el.classList.toggle('active', el.dataset.id === activeResource);
    });
    document.querySelectorAll('.prio').forEach(el => {
      el.classList.toggle('active', el.dataset.id === activePriority);
    });
  }

  function createCustomIcon(iconUrl, priorityColor) {
    const div = document.createElement('div');
    div.className = 'marker-wrapper';
    div.innerHTML = `
      <img src="${iconUrl}" />
      <div class="marker-priority" style="background:${priorityColor}"></div>
    `;
    return L.divIcon({
      className: '',
      html: div.outerHTML,
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });
  }

  resourcesWithIcons.forEach(res => {
    const el = document.createElement('div');
    el.className = 'icon';
    el.dataset.id = res.id;
    el.innerHTML = `<img src="${res.iconUrl}" alt="${res.name}"><span>${res.name}</span>`;
    el.addEventListener('click', () => {
      activeResource = res.id;
      updateLegendUI();
    });
    legendDiv.appendChild(el);
  });

  priorities.forEach(p => {
    const el = document.createElement('div');
    el.className = 'prio';
    el.dataset.id = p.id;
    el.innerHTML = `<div style="background:${p.color}"></div><span>${p.name}</span>`;
    el.addEventListener('click', () => {
      activePriority = p.id;
      updateLegendUI();
    });
    priorityDiv.appendChild(el);
  });

  map.on('click', e => {
    if (!activeResource || !activePriority) return;
    const res = resourcesWithIcons.find(r => r.id === activeResource);
    const prio = priorities.find(p => p.id === activePriority);
    const icon = createCustomIcon(res.iconUrl, prio.color);
    L.marker(e.latlng, { icon }).addTo(markersLayer).bindPopup(`${res.name} (${prio.name})`);
  });
</script>

</body>
</html>
